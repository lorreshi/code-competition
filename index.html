<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小米运动健康AI个人助理</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* 全局样式 */
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(120deg, #f6d365, #fda085);
      overflow-x: hidden;
    }

    /* 容器样式 */
    .container {
      width: 95%;
      max-width: 1200px;
      margin: 20px auto;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    /* 头部标题样式 */
    .header {
      text-align: center;
      font-size: 24px;
      color: #f7941d;
      margin-bottom: 20px;
      font-weight: bold;
    }

    /* 日期选择器样式 */
    .date-picker {
      position: absolute;
      top: 20px;
      right: 20px;
    }

    .date-picker input {
      padding: 5px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    /* 按钮组样式 */
    .buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .buttons button {
      margin: 5px;
      padding: 10px 15px;
      background-color: #f7941d;
      border: none;
      color: white;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .buttons button:hover {
      background-color: #e68219;
      transform: scale(1.1);
    }

    .buttons button:active {
      transform: scale(0.95);
    }

    /* 模块通用样式 */
    .module {
      border: 2px solid #f7941d;
      border-radius: 12px;
      padding: 20px;
      margin: 10px 0;
      background-color: #fff;
      color: #333;
      text-align: center;
      font-size: 1.1em;
    }

    /* 合并输出框样式 */
    #combined-output {
      border: 2px solid #f7941d;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      background-color: #fff;
      color: #333;
      font-size: 1.2em;
      text-align: center;
    }

    /* 数据列布局样式 */
    .data-columns {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }

    .column {
      flex: 1;
      min-width: 280px; /* 控制每个模块最小宽度 */
    }

    /* 响应式布局：屏幕宽度小于等于768px时，数据列变为单列布局 */
    @media (max-width: 768px) {
      .data-columns {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
<div class="container">
  <!-- 头部标题 -->
  <div class="header">小米运动健康AI个人助理</div>

  <!-- 日期选择器 -->
  <div class="date-picker">
    <label for="date">选择日期：</label>
    <input type="date" id="date" name="date">
  </div>

  <!-- 合并后的输出框 -->
  <div id="combined-output">点击右侧按钮获取健康建议、饮食建议和运动建议</div>

  <!-- 按钮组 -->
  <div class="buttons">
    <button id="get-health-suggestion">获取健康建议</button>
    <button id="get-diet-suggestion">获取饮食建议</button>
    <button id="get-exercise-suggestion">获取运动建议</button>
  </div>

  <!-- 数据展示区域 -->
  <div class="data-columns">
    <!-- 第一行：个人信息、今日饮食概览、今日运动概览 -->
    <div class="column">
      <div class="module" id="personal-info">
        <h2>个人信息</h2>
        <div class="value" id="personal-info-value">身高: -- cm<br>体重: -- kg<br>性别: --</div>
      </div>
    </div>
    <div class="column">
      <div class="module" id="diet-info">
        <h2>今日饮食概览</h2>
        <div class="value" id="diet-info-value">-- kcal</div>
      </div>
    </div>
    <div class="column">
      <div class="module" id="exercise-info">
        <h2>今日运动概览</h2>
        <div class="value" id="exercise-info-value">-- 运动量</div>
      </div>
    </div>

    <!-- 第二行：心率概览和睡眠概览 -->
    <div class="column">
      <div class="module" id="heart-rate">
        <h2>心率</h2>
        <div class="value" id="heart-rate-value">-- 次/分钟</div>
      </div>
    </div>
    <div class="column">
      <div class="module" id="sleep">
        <h2>睡眠</h>
          <div class="value" id="sleep-value">-- 小时</div>
      </div>
    </div>

    <!-- 第三行：步数概览和卡路里概览 -->
    <div class="column">
      <div class="module" id="steps">
        <h2>步数</h2>
        <div class="value" id="steps-value">-- 步</div>
      </div>
    </div>
    <div class="column">
      <div class="module" id="calories">
        <h2>卡路里</h2>
        <div class="value" id="calories-value">-- 千卡</div>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  // 逐字显示文本的函数
  function typeText(elementId, text, speed) {
    const element = document.getElementById(elementId);
    element.textContent = ""; // 清空之前的内容
    let index = 0;

    function type() {
      if (index < text.length) {
        element.textContent += text[index];
        index++;
        setTimeout(type, speed); // 递归调用，逐字显示
      }
    }

    type();
  }

  // 重置建议显示内容的函数
  function resetSuggestions() {
    typeText("combined-output", "点击右侧按钮获取健康建议、饮食建议和运动建议", 50);
  }

  // 更新各个模块数据显示的函数
  function updateModules(data) {
    $("#personal-info-value").html(
            `身高: ${data.height} cm<br>体重: ${data.weight} kg<br>性别: ${data.gender}`
    );
    $("#diet-info-value").text(`${data.diet_kcal} kcal`);
    $("#exercise-info-value").text(`${data.exercise} 运动量`);
    $("#heart-rate-value").text(`${data.heart_rate} 次/分钟`);
    $("#sleep-value").text(`${data.sleep_hours} 小时`);
    $("#steps-value").text(`${data.steps} 步`);
    $("#calories-value").text(`${data.calories} 千卡`);
  }

  // 日期选择器 change事件处理函数
  $("#date").change(function () {
    const selectedDate = $(this).val();
    if (!selectedDate) return;

    resetSuggestions(); // 选择新日期时重置建议显示内容

    $.ajax({
      url: "/get_data",
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify({ date: selectedDate }),
      success: function (response) {
        if (response.error) {
          alert(response.error);
        } else {
          updateModules(response);
        }
      },
      error: function () {
        alert("未找到对应日期的数据！");
      }
    });
  });

  // 获取特定建议的通用函数
  function fetchSuggestion(route, outputId) {
    const selectedDate = $("#date").val();
    if (!selectedDate) {
      alert("请选择一个日期！");
      return;
    }

    $.ajax({
      url: route,
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify({ date: selectedDate }),
      success: function (response) {
        if (response.error) {
          alert(response.error);
        } else {
          typeText(outputId, response[Object.keys(response)[0]], 50); // 流式吐字
        }
      },
      error: function () {
        alert("请求失败，请稍后重试！");
      }
    });
  }

  // 获取健康建议按钮点击事件处理函数
  $("#get-health-suggestion").click(function () {
    fetchSuggestion("/get_health_suggestion", "combined-output");
  });

  // 获取饮食建议按钮点击事件处理函数
  $("#get-diet-suggestion").click(function () {
    fetchSuggestion("/get_diet_suggestion", "combined-output");
  });

  // 获取运动建议按钮点击事件处理函数
  $("#get-exercise-suggestion").click(function () {
    fetchSuggestion("/get_exercise_suggestion", "combined-output");
  });
</script>
</body>

</html>